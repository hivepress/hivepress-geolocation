!function(e){"use strict";hivepress.initGeolocation=function(t=null){null===t&&(t=e("body")),t.find(hivepress.getSelector("location")).each(function(){var t=e(this),o=t.closest("form"),a=t.find("input[type=text]"),n=o.find("input[data-coordinate=lat]"),i=o.find("input[data-coordinate=lng]"),r=o.find("input[data-region]"),s=t.find("a"),l={};if("undefined"!=typeof mapboxData){l={accessToken:mapboxData.apiKey,language:hivepressCoreData.language},t.data("countries")&&(l.countries=t.data("countries").join(",")),t.data("types")&&(l.types=t.data("types").join(","));var d=new MapboxGeocoder(l);d.addTo(t.get(0));var c=t.children(".mapboxgl-ctrl"),p=a.prop("attributes");a.remove(),a=c.find("input[type=text]"),e.each(p,function(){a.attr(this.name,this.value)}),c.detach().prependTo(t),d.on("result",function(e){var t=["place","district","region","country"];r.length&&(e.result.place_type.filter(e=>t.includes(e)).length?r.val(e.result.id):r.val("")),i.val(e.result.geometry.coordinates[0]),n.val(e.result.geometry.coordinates[1])})}else l={details:o,detailsAttribute:"data-coordinate"},t.data("countries")&&(l.componentRestrictions={country:t.data("countries")}),t.data("types")&&(l.types=t.data("types")),a.geocomplete(l),a.bind("geocode:result",function(o,n){var i=[],s=["locality","administrative_area_level_2","administrative_area_level_1","country"];r.length&&(n.address_components[0].types.filter(e=>s.includes(e)).length?r.val(n.place_id):r.val("")),t.data("scatter")&&(s.push("route"),e.each(n.address_components,function(e,t){t.types.filter(e=>s.includes(e)).length&&i.push(t.long_name)}),a.val(i.join(", ")))});a.on("input",function(){a.val()||o.find("input[data-coordinate]").val("")}),navigator.geolocation?s.on("click",function(e){navigator.geolocation.getCurrentPosition(function(e){"undefined"!=typeof mapboxData?(d.options.reverseGeocode=!0,d.options.limit=1,d.query(e.coords.latitude+","+e.coords.longitude),d.options.reverseGeocode=!1,d.options.limit=5):a.geocomplete("find",e.coords.latitude+" "+e.coords.longitude)}),e.preventDefault()}):s.hide()}),t.find(hivepress.getSelector("map")).each(function(){var t=e(this),o=t.width(),a=t.data("max-zoom");if(t.is("[data-height]")&&(o=t.data("height")),t.height(o),"undefined"!=typeof mapboxData){mapboxgl.accessToken=mapboxData.apiKey;var n=new mapboxgl.LngLatBounds;(s=new mapboxgl.Map({container:t.get(0),style:"mapbox://styles/mapbox/streets-v11",center:[0,0],zoom:1})).addControl(new mapboxgl.NavigationControl),s.addControl(new mapboxgl.FullscreenControl),s.addControl(new MapboxLanguage),e.each(t.data("markers"),function(e,t){n.extend([t.longitude,t.latitude]);(new mapboxgl.Marker).setLngLat([t.longitude,t.latitude]).setPopup((new mapboxgl.Popup).setHTML(t.content)).addTo(s)}),s.fitBounds(n,{maxZoom:a-1,padding:50,duration:0});new ResizeObserver(function(){s.resize(),s.fitBounds(n,{maxZoom:a-1,padding:50,duration:0})}).observe(t.get(0))}else{var i=!1,r=[],s=(n=new google.maps.LatLngBounds,new google.maps.Map(t.get(0),{zoom:3,minZoom:2,maxZoom:a,mapTypeControl:!1,streetViewControl:!1,center:{lat:0,lng:0},styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]})),l=new OverlappingMarkerSpiderfier(s,{markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0}),d={path:google.maps.SymbolPath.CIRCLE,fillColor:"#3a77ff",fillOpacity:.25,strokeColor:"#3a77ff",strokeWeight:1,strokeOpacity:.75,scale:10};e.each(t.data("markers"),function(e,o){var a=new google.maps.InfoWindow({content:o.content}),c={title:o.title,position:{lat:o.latitude,lng:o.longitude}};t.data("scatter")&&(c.icon=d);var p=new google.maps.Marker(c);p.addListener("spider_click",function(){i&&i.close(),i=a,a.open(s,p)}),r.push(p),l.addMarker(p),n.extend(p.getPosition())}),s.fitBounds(n);new ResizeObserver(function(){s.fitBounds(n)}).observe(t.get(0)),new MarkerClusterer(s,r,{imagePath:hivepressGeolocationData.assetURL+"/images/markerclustererplus/m",maxZoom:a-1});t.data("scatter")&&s.addListener("zoom_changed",function(){d.scale=Math.pow(1.3125,s.getZoom()),e.each(r,function(e,t){r[e].setIcon(d)})})}})},e(document).on("hivepress:init",function(e,t){t.is("body")||hivepress.initGeolocation(t)}),"undefined"!=typeof mapboxData&&hivepress.initGeolocation()}(jQuery);
