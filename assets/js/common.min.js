var map="";hivepress.initGeolocation=function(){(function(a){"use strict";a(document).ready(function(){hivepress.getComponent("location").each(function(){var b=a(this),c=b.closest("form"),d=b.find("input[type=text]"),e=c.find("input[data-coordinate=lat]"),f=c.find("input[data-coordinate=lng]"),g=c.find("input[data-region]"),h=b.find("a"),i={},j=b.attr("data-format"),k={};if("undefined"!=typeof mapboxData){i={accessToken:mapboxData.apiKey,language:hivepressCoreData.language},b.data("countries")&&(i.countries=b.data("countries").join(",")),b.data("types")&&(i.types=b.data("types").join(","));var l=new MapboxGeocoder(i);l.addTo(b.get(0));var m=b.children(".mapboxgl-ctrl"),n=d.prop("attributes");d.remove(),d=m.find("input[type=text]"),a.each(n,function(){d.attr(this.name,this.value)}),m.detach().prependTo(b),l.on("result",function(c){var h=["place","district","region","country"];if(g.length&&(c.result.place_type.filter(a=>h.includes(a)).length?g.val(c.result.id):g.val("")),typeof j!="undefined"&&!1!==j)j=b.attr("data-format"),k={address:{value:"",token:"%place_address%"},place:{value:"",token:"%city%"},district:{value:"",token:"%county%"},region:{value:"",token:"%state%"},country:{value:"",token:"%country%"}},c.result.place_type.forEach(function(a){"address"===a?(k.address.value=c.result.text,"undefined"!=typeof c.result.address&&!b.data("scatter")&&(k.address.value+=" "+c.result.address)):"poi"===a?b.data("scatter")?k.address.value=c.result.properties.address.replace(/\d+/g,"").trim():k.address.value=c.result.properties.address:void 0!==k[a]&&(k[a].value=c.result.text)}),c.result.context.forEach(function(a){void 0!==k[a.id.split(".")[0]]&&(k[a.id.split(".")[0]].value=a.text)}),a.each(k,function(a){j=j.replace(k[a].token,k[a].value)}),d.val(j);else if(b.data("scatter")){var i=[];c.result.place_type.forEach(function(a){return"address"===a?(i.push(c.result.text),!1):"poi"===a?(i.push(c.result.properties.address.replace(/\d+/g,"").trim()),!1):void 0}),c.result.context.forEach(function(a){"postcode"!==a.id.split(".")[0]&&i.push(a.text)}),d.val(i.join(", "))}f.val(c.result.geometry.coordinates[0]),e.val(c.result.geometry.coordinates[1])})}else i={details:c,detailsAttribute:"data-coordinate"},b.data("countries")&&(i.componentRestrictions={country:b.data("countries")}),b.data("types")&&(i.types=b.data("types")),d.geocomplete(i),d.bind("geocode:result",function(c,e){var f=[],h=["locality","administrative_area_level_2","administrative_area_level_1","country"];g.length&&(e.address_components[0].types.filter(a=>h.includes(a)).length?g.val(e.place_id):g.val("")),typeof j!="undefined"&&!1!==j?(h.push("route","street_number"),j=b.attr("data-format"),k={route:{value:"",token:"%place_address%"},locality:{value:"",token:"%city%"},administrative_area_level_2:{value:"",token:"%county%"},administrative_area_level_1:{value:"",token:"%state%"},country:{value:"",token:"%country%"}},a.each(e.address_components,function(a,c){c.types.filter(a=>h.includes(a)).length&&c.types.forEach(function(a){"street_number"!==a||b.data("scatter")?"route"===a?k.route.value=c.long_name+k.route.value:void 0!==k[a]&&(k[a].value=c.long_name):k.route.value=" "+c.long_name})}),a.each(k,function(a){j=j.replace(k[a].token,k[a].value)}),d.val(j)):b.data("scatter")&&(h.push("route"),a.each(e.address_components,function(a,b){b.types.filter(a=>h.includes(a)).length&&f.push(b.long_name)}),d.val(f.join(", ")))});d.on("input",function(){d.val()||c.find("input[data-coordinate]").val("")}),navigator.geolocation?h.on("click",function(a){navigator.geolocation.getCurrentPosition(function(a){"undefined"==typeof mapboxData?d.geocomplete("find",a.coords.latitude+" "+a.coords.longitude):(l.options.reverseGeocode=!0,l.options.limit=1,l.query(a.coords.latitude+","+a.coords.longitude),l.options.reverseGeocode=!1,l.options.limit=5)}),a.preventDefault()}):h.hide()}),hivepress.getComponent("map").each(function(){var b=a(this),c=b.width(),d=b.data("max-zoom");if(b.is("[data-height]")&&(c=b.data("height")),b.height(c),"undefined"!=typeof mapboxData){mapboxgl.accessToken=mapboxData.apiKey;var e=new mapboxgl.LngLatBounds;map=new mapboxgl.Map({container:b.get(0),style:"mapbox://styles/mapbox/streets-v11",center:[0,0],zoom:1}),map.addControl(new mapboxgl.NavigationControl),map.addControl(new mapboxgl.FullscreenControl),map.addControl(new MapboxLanguage);var f=[];a.each(b.data("markers"),function(a,b){e.extend([b.longitude,b.latitude]),f.push({type:"Feature",geometry:{type:"Point",coordinates:[b.longitude,b.latitude]},properties:{content:b.content}})}),map.fitBounds(e,{maxZoom:d-1,duration:0}),map.on("load",()=>{map.addSource("locations",{type:"geojson",data:{type:"FeatureCollection",features:f},cluster:!0,clusterMaxZoom:12,clusterRadius:50}),map.addLayer({id:"clusters",type:"circle",source:"locations",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#51bbd6",100,"#f1f075",750,"#f28cb1"],"circle-radius":["step",["get","point_count"],20,100,30,750,40]}}),map.addLayer({id:"cluster-count",type:"symbol",source:"locations",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}}),b.attr("data-scatter")?(map.setMaxZoom(13),map.addLayer({id:"unclustered-point",type:"circle",source:"locations",maxzoom:16,filter:["!",["has","point_count"]],paint:{"circle-color":"#11b4da","circle-radius":100,"circle-opacity":.5}})):map.loadImage(mapboxData.markerImage,(a,b)=>{map.addImage("custom-marker",b),map.addLayer({id:"unclustered-point",type:"symbol",source:"locations",filter:["!",["has","point_count"]],layout:{"icon-image":"custom-marker"}})}),map.on("click","clusters",a=>{const b=map.queryRenderedFeatures(a.point,{layers:["clusters"]}),c=b[0].properties.cluster_id;map.getSource("locations").getClusterExpansionZoom(c,(a,c)=>{a||map.easeTo({center:b[0].geometry.coordinates,zoom:c})})}),map.on("click","unclustered-point",a=>{var b=Math.abs;const c=a.features[0].geometry.coordinates.slice(),d=a.features[0].properties.content;for(;180<b(a.lngLat.lng-c[0]);)c[0]+=a.lngLat.lng>c[0]?360:-360;new mapboxgl.Popup().setLngLat(c).setHTML(d).addTo(map)}),map.on("mouseenter","clusters",()=>{map.getCanvas().style.cursor="pointer"}),map.on("mouseleave","clusters",()=>{map.getCanvas().style.cursor=""})})}else{map=new google.maps.Map(b.get(0),{zoom:3,minZoom:2,maxZoom:d,mapTypeControl:!1,streetViewControl:!1,center:{lat:0,lng:0},styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]});var g=!1,h=[],e=new google.maps.LatLngBounds,i=new OverlappingMarkerSpiderfier(map,{markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0}),j={path:google.maps.SymbolPath.CIRCLE,fillColor:"#3a77ff",fillOpacity:.25,strokeColor:"#3a77ff",strokeWeight:1,strokeOpacity:.75,scale:10};a.each(b.data("markers"),function(a,c){var d=new google.maps.InfoWindow({content:c.content}),f={title:c.title,position:{lat:c.latitude,lng:c.longitude}};b.data("scatter")&&(f.icon=j);var k=new google.maps.Marker(f);k.addListener("spider_click",function(){g&&g.close(),g=d,d.open(map,k)}),h.push(k),i.addMarker(k),e.extend(k.getPosition())}),map.fitBounds(e);var k=new MutationObserver(function(){map.fitBounds(e)});k.observe(b.get(0),{attributes:!0});new MarkerClusterer(map,h,{imagePath:hivepressGeolocationData.assetURL+"/images/markerclustererplus/m",maxZoom:d-1});b.data("scatter")&&map.addListener("zoom_changed",function(){var b=Math.pow;j.scale=b(1.3125,map.getZoom()),a.each(h,function(a){h[a].setIcon(j)})})}})})})(jQuery)},"undefined"!=typeof mapboxData&&hivepress.initGeolocation(),function(a){"use strict";a(document).ready(function(){hivepress.getComponent("toggle").each(function(){var b=a(this);b.on("click",function(){"undefined"!=typeof mapboxData&&"map"===b.attr("data-toggle")&&"active"===b.attr("data-state")&&map.resize()})})})}(jQuery);