hivepress.initGeolocation=function(){(function(a){"use strict";a(document).ready(function(){hivepress.getComponent("location").each(function(){var b=a(this),c=b.closest("form"),d=b.find("input[type=text]"),e=c.find("input[data-coordinate=lat]"),f=c.find("input[data-coordinate=lng]"),g=c.find("input[data-region]"),h=b.find("a"),i={};if("undefined"!=typeof mapboxData){i={accessToken:mapboxData.apiKey,language:hivepressCoreData.language},b.data("countries")&&(i.countries=b.data("countries").join(",")),b.data("types")&&(i.types=b.data("types").join(","));var j=new MapboxGeocoder(i);j.addTo(b.get(0));var k=b.children(".mapboxgl-ctrl"),l=d.prop("attributes");d.remove(),d=k.find("input[type=text]"),a.each(l,function(){d.attr(this.name,this.value)}),k.detach().prependTo(b),j.on("result",function(a){var b=["place","district","region","country"];g.length&&(a.result.place_type.filter(a=>b.includes(a)).length?g.val(a.result.id):g.val("")),f.val(a.result.geometry.coordinates[0]),e.val(a.result.geometry.coordinates[1])})}else i={details:c,detailsAttribute:"data-coordinate"},b.data("countries")&&(i.componentRestrictions={country:b.data("countries")}),b.data("types")&&(i.types=b.data("types")),d.geocomplete(i),d.bind("geocode:result",function(c,e){var f=[],h=["locality","administrative_area_level_2","administrative_area_level_1","country"];g.length&&(e.address_components[0].types.filter(a=>h.includes(a)).length?g.val(e.place_id):g.val("")),b.data("scatter")&&(h.push("route"),a.each(e.address_components,function(a,b){b.types.filter(a=>h.includes(a)).length&&f.push(b.long_name)}),d.val(f.join(", ")))});d.on("input",function(){d.val()||c.find("input[data-coordinate]").val("")}),navigator.geolocation?h.on("click",function(a){navigator.geolocation.getCurrentPosition(function(a){"undefined"!=typeof mapboxData||d.geocomplete("find",a.coords.latitude+" "+a.coords.longitude)}),a.preventDefault()}):h.hide()}),hivepress.getComponent("map").each(function(){var b=a(this),c=b.data("max-zoom");if("undefined"!=typeof mapboxData){mapboxgl.accessToken=mapboxData.apiKey;var d=new mapboxgl.LngLatBounds,e=new mapboxgl.Map({container:b.get(0),style:"mapbox://styles/mapbox/streets-v11",center:[0,0],zoom:1});e.on("load",function(){e.getStyle().layers.forEach(function(a){0<a.id.indexOf("-label")&&e.setLayoutProperty(a.id,"text-field",["get","name_"+hivepressCoreData.language])})}),a.each(b.data("markers"),function(a,b){d.extend([b.longitude,b.latitude]);new mapboxgl.Marker().setLngLat([b.longitude,b.latitude]).setPopup(new mapboxgl.Popup().setHTML(b.content)).addTo(e)}),e.fitBounds(d,{maxZoom:c-1,duration:0})}else{var f=b.width(),g=!1,h=[],d=new google.maps.LatLngBounds,e=new google.maps.Map(b.get(0),{zoom:3,minZoom:2,maxZoom:c,mapTypeControl:!1,streetViewControl:!1,center:{lat:0,lng:0},styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]}),i=new OverlappingMarkerSpiderfier(e,{markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0}),j={path:google.maps.SymbolPath.CIRCLE,fillColor:"#3a77ff",fillOpacity:.25,strokeColor:"#3a77ff",strokeWeight:1,strokeOpacity:.75,scale:10};b.is("[data-height]")&&(f=b.data("height")),b.height(f),a.each(b.data("markers"),function(a,c){var f=new google.maps.InfoWindow({content:c.content}),k={title:c.title,position:{lat:c.latitude,lng:c.longitude}};b.data("scatter")&&(k.icon=j);var l=new google.maps.Marker(k);l.addListener("spider_click",function(){g&&g.close(),g=f,f.open(e,l)}),h.push(l),i.addMarker(l),d.extend(l.getPosition())}),e.fitBounds(d);var k=new MutationObserver(function(){e.fitBounds(d)});k.observe(b.get(0),{attributes:!0});new MarkerClusterer(e,h,{imagePath:hivepressGeolocationData.assetURL+"/images/markerclustererplus/m",maxZoom:c-1});b.data("scatter")&&e.addListener("zoom_changed",function(){j.scale=Math.pow(1.3125,e.getZoom()),a.each(h,function(a){h[a].setIcon(j)})})}})})})(jQuery)},"undefined"!=typeof mapboxData&&hivepress.initGeolocation();