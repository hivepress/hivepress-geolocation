(function(a){"use strict";a(document).ready(function(){hivepress.getComponent("map").each(function(){var b=a(this),c=b.data("max-zoom"),d=mapboxData.apiKey;if("mapbox"===mapboxData.provider&&d){mapboxgl.accessToken=d,i=new mapboxgl.Map({container:b.get(0),style:"mapbox://styles/mapbox/streets-v11",center:[0,0],zoom:1});var e=new mapboxgl.LngLatBounds;a.each(b.data("markers"),function(a,b){e.extend([b.longitude,b.latitude]),new mapboxgl.Marker().setLngLat([b.longitude,b.latitude]).setPopup(new mapboxgl.Popup().setHTML(b.content)).addTo(i)}),i.fitBounds(e,{maxZoom:c-1})}else{var f=b.width(),g=!1,h=[],e=new google.maps.LatLngBounds,i=new google.maps.Map(b.get(0),{zoom:3,minZoom:2,maxZoom:c,mapTypeControl:!1,streetViewControl:!1,center:{lat:0,lng:0},styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]}),j=new OverlappingMarkerSpiderfier(i,{markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0}),k={path:google.maps.SymbolPath.CIRCLE,fillColor:"#3a77ff",fillOpacity:.25,strokeColor:"#3a77ff",strokeWeight:1,strokeOpacity:.75,scale:10};b.is("[data-height]")&&(f=b.data("height")),b.height(f),a.each(b.data("markers"),function(a,c){var d=new google.maps.InfoWindow({content:c.content}),f={title:c.title,position:{lat:c.latitude,lng:c.longitude}};b.data("scatter")&&(f.icon=k);var l=new google.maps.Marker(f);l.addListener("spider_click",function(){g&&g.close(),g=d,d.open(i,l)}),h.push(l),j.addMarker(l),e.extend(l.getPosition())}),i.fitBounds(e);var l=new MutationObserver(function(){i.fitBounds(e)});l.observe(b.get(0),{attributes:!0});new MarkerClusterer(i,h,{imagePath:hivepressGeolocationData.assetURL+"/images/markerclustererplus/m",maxZoom:c-1});b.data("scatter")&&i.addListener("zoom_changed",function(){k.scale=Math.pow(1.3125,i.getZoom()),a.each(h,function(a){h[a].setIcon(k)})})}}),hivepress.getComponent("location").each(function(){var b=a(this),c=b.find("input[type=text]"),d=c.closest("form"),e=mapboxData.apiKey;if("mapbox"===mapboxData.provider&&e){mapboxgl.accessToken||(mapboxgl.accessToken=e);const d=new MapboxGeocoder({accessToken:mapboxgl.accessToken,mapboxgl:mapboxgl,language:hivepressCoreData.language,types:"country, region, district, place, locality, address",worldview:mapboxData.region});d.on("result",function(c){var d=c.result.text,e={place:"",district:"",region:"",country:""},f="",g=!1;b.closest("form").find("input[data-coordinate=\"lng\"]").val(c.result.geometry.coordinates[0]),b.closest("form").find("input[data-coordinate=\"lat\"]").val(c.result.geometry.coordinates[1]),a.each(c.result.place_type,function(a,b){if(e[b]=d,"address"===d)return g=!0,!1}),g||(a.each(c.result.context,function(a,b){e[b.id.split(".")[0]]=b.text}),a.each(e,function(a,b){b&&(f+="|"+b)}),f=f.substring(1)),a("input[data-regions]").val(f)}),a(b).prepend(d.onAdd(null));var f={class:c.attr("class"),placeholder:c.attr("placeholder"),maxlength:c.attr("maxlength"),name:c.attr("name"),required:c.attr("required")},g=c.val();c.add(".mapboxgl-ctrl-geocoder--icon-search, .mapboxgl-ctrl-geocoder--button").remove(),b.find(".mapboxgl-ctrl-geocoder--input").attr(f).val(g)}else{var h=b.find("a"),i={details:d,detailsAttribute:"data-coordinate"};b.data("countries")&&(i.componentRestrictions={country:b.data("countries")}),b.data("types")&&(i.types=b.data("types")),c.geocomplete(i).bind("geocode:result",function(b,c){var d=[],e=["locality","administrative_area_level_1","administrative_area_level_2","country"];a.each(c.address_components,function(a,b){return 0<=b.types.indexOf("route")?(d=[],!1):void(b.types.filter(function(a){return-1!==e.indexOf(a)}).length&&d.push(b.long_name))}),a("input[data-regions]").val(d.join("|"))}),b.data("scatter")&&c.bind("geocode:result",function(b,d){var e=[],f=["route","locality","administrative_area_level_1","administrative_area_level_2","country"];a.each(d.address_components,function(a,b){b.types.filter(function(a){return-1!==f.indexOf(a)}).length&&e.push(b.long_name)}),c.val(e.join(", "))}),c.on("input",function(){c.val()||b.closest("form").find("input[data-coordinate]").val("")}),navigator.geolocation?h.on("click",function(a){navigator.geolocation.getCurrentPosition(function(a){c.geocomplete("find",a.coords.latitude+" "+a.coords.longitude)}),a.preventDefault()}):h.hide()}})})})(jQuery);